name: "Call action manually: framework compose filename"

on:
  workflow_dispatch:
    inputs:
      runner:
        description: "Runner to use"
        type: choice
        options:
          - ubuntu-latest
          - ubuntu-22.04
          - windows-latest
          - macos-latest
        required: true
        default: ubuntu-latest
      pattern:
        description: "Pattern (e.g. opendaq-*-*.*, opendaq-3.20.4-*.*)"
        required: false
        type: string
      version:
        description: "Version (e.g. 3.20.4, v3.20.4, latest)"
        required: false
        type: string
      platform:
        description: "Platform (e.g. ubuntu22.04-x86_64, win64, macos13-arm64)"
        required: false
        type: string
      packaging:
        description: "Packaging (DEB, NSIS, TARGZ, ZIP)"
        type: choice
        options:
          - ""
          - DEB
          - NSIS
          - TARGZ
          - ZIP
        required: false
        default: ""

jobs:
  dispatch-action:
    runs-on: ${{ inputs.runner }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Call framework compose filename action
        id: call-framework-compose-filename
        uses: ./framework-compose-filename
        with:
          pattern: ${{ inputs.pattern }}
          version: ${{ inputs.version }}
          platform: ${{ inputs.platform }}
          packaging: ${{ inputs.packaging }}

      - name: Display framework compose filename action outputs
        shell: bash
        env:
          OPENDAQ_COMPOSE_FILENAME: ${{ steps.call-framework-compose-filename.outputs.filename }}
          OPENDAQ_COMPOSE_EXTENSION: ${{ steps.call-framework-compose-filename.outputs.extension }}
          OPENDAQ_COMPOSE_VERSION: ${{ steps.call-framework-compose-filename.outputs.version }}
          OPENDAQ_COMPOSE_VERSION_MAJOR: ${{ steps.call-framework-compose-filename.outputs.version-major }}
          OPENDAQ_COMPOSE_VERSION_MINOR: ${{ steps.call-framework-compose-filename.outputs.version-minor }}
          OPENDAQ_COMPOSE_VERSION_PATCH: ${{ steps.call-framework-compose-filename.outputs.version-patch }}
          OPENDAQ_COMPOSE_PLATFORM: ${{ steps.call-framework-compose-filename.outputs.platform }}
          OPENDAQ_COMPOSE_PACKAGING: ${{ steps.call-framework-compose-filename.outputs.packaging }}
        run: |
          echo "=== Action output === "
          echo "'$OPENDAQ_COMPOSE_FILENAME'"
          echo "├── extension: '$OPENDAQ_COMPOSE_EXTENSION'"
          echo "├── packaging: '$OPENDAQ_COMPOSE_PACKAGING'"
          echo "├── platform: '$OPENDAQ_COMPOSE_PLATFORM'"
          echo "└── version: '$OPENDAQ_COMPOSE_VERSION'"
          echo "    ├── major: '$OPENDAQ_COMPOSE_VERSION_MAJOR'"
          echo "    ├── minor: '$OPENDAQ_COMPOSE_VERSION_MAJOR'"
          echo "    └── patch: '$OPENDAQ_COMPOSE_VERSION_PATCH'"
